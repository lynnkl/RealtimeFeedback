<%- include ("_partial/_header.ejs"); %>
<div class="container-fluid h-auto"></div>
    <div class="row h-100">
        <div class="col-1"></div>
        <div class="col-6 pt-5">
            <h3>Neues Feedback schreiben</h3>
            <div class="row">
                <div class="col-6">
                    <form action="/realtimefeedback/addOne" method="POST">
                        <div class="form-group">
                            <label for="classContent">Lektion</label>
                            <input type="text" class="form-control" id="classContent" placeholder="Lektion auswählen..." name="classContent" readonly></textarea>
                        </div>

                        <div class="form-group">
                            <label for="feedbackContent">Feedback (max. 150 Zeichen)</label>
                            <input type="text" class="form-control" maxlength = "150" rows="3" id="feedbackContent"
                                placeholder="Dein Feedback..." name="feedbackContent"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="ratingContent">Rating</label>
                            <select class="form-control" rows="3" id="ratingContent" name="ratingContent">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <button type="submit" class="btn btn-primary" href="#" role="button">Absenden</button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="row feedbackContainer">
                <!--Listet alle feedbacks-->
                <% feedbacks.forEach(function(feedback) { %>
                    <div class="col-sm-4 col-md-4 feedback-card pb-5" data-course-id="<%= feedback.class %>">
                        <div class="card h-100">
                            <div class="caption">
                                <h6>
                                    <%= feedback.userID %> bewertet <%= feedback.class %> mit:
                                </h6>
                                <p>
                                    <% for (let i = 0; i < 5; i++) { %>
                                        <% if (feedback.rating > i) { %>
                                            <span class="star-filled">&#9733;</span>
                                        <% } else { %>
                                            <span class="star-empty">&#9734;</span>
                                        <% } %>
                                    <% } %>
                                </p>
                                <p>
                                    <%= feedback.feedback %>
                                </p>
                            </div>
                        </div>
                    </div>
                <% }) %>
            </div>
        </div>
        <div class="col-1"></div>
        <div class="col-3 d-flex flex-column justify-content-center" id="course-captions">
            <div class="caption course-caption pt-3 pb-3">
                <h3 class="course-title">Mathe</h3>
                <p><b>Herr Schmidt</b> | Raum 203 | Montag, 8:00 - 9:30 Uhr</p>
            </div>
            <div class="caption course-caption pt-3 pb-3">
                <h3 class="course-title">Deutsch</h3>
                <p><b>Frau Davis</b> | Raum 115 | Dienstag, 10:00 - 11:30 Uhr</p>
            </div>
            <div class="caption course-caption pt-3 pb-3">
                <h3 class="course-title">Englisch</h3>
                <p><b>Herr Müller </b> | Raum 305 | Mittwoch, 13:00 - 14:30 Uhr</p>
            </div>
            <div class="caption course-caption pt-3 pb-3">
                <h3 class="course-title">Wirtschaft</h3>
                <p><b>Frau Ki</b> | Raum 212 | Donnerstag, 11:00 - 12:30 Uhr</p>
            </div>
            <div class="caption course-caption pt-3 pb-3">
                <h3 class="course-title">ICT</h3>
                <p><b>Herr Wagner</b> | Raum 402 | Freitag, 14:00 - 15:30 Uhr</p>
            </div>
        </div>
        <div class="col-1"></div>
    </div>

    <script>
        // Dom manipulation
        const captions = document.querySelectorAll('.course-caption');
        const feedbackCards = document.querySelectorAll('.feedback-card');

        // filtert die feedbacks nach ausgewählter lektion
        captions.forEach((caption) => {
            caption.addEventListener('click', () => {
                const selectedCourseTitle = caption.firstElementChild.innerHTML;
                const targetTitle = document.getElementById('classContent');
                targetTitle.value = selectedCourseTitle;
                const filteredFeedbacks = Array.from(feedbackCards).filter((card) => card.dataset.courseId === selectedCourseTitle);
                updateFeedbackSection(filteredFeedbacks);
            });
        });

        function updateFeedbackSection(filteredFeedbacks) {
            const feedbackContainer = document.querySelector('.feedbackContainer');
            feedbackContainer.innerHTML = '';

            filteredFeedbacks.forEach((feedback) => {
                feedbackContainer.appendChild(feedback);
            });
        }
    </script>

    <%- include ("_partial/_footer.ejs"); %>